
Rx<x>:=PolynomialRing(Rationals());
//this is phi : X^*(6,P2) -> X^*(6,1)
//X := Curve(ProjectiveSpace(PolynomialRing(Rationals(), 2)));
//KX<x> := FunctionField(X);
//phi1Elkies := Rx!(-1*(16*x^6-24*x^4+9*x^2-1))-1;
//phi1LY:=(-1/27)*phi1Elkies;
//BelyiMap:=phi1LY;


phiX2Elkies:=Rx!x*(x-3)^2/4;
c:=-1;
phiX4Elkies:=Rx!Evaluate(phiX2Elkies,c*x^2);
phiX4LY:=(-1/27)*phiX4Elkies;
BelyiMap:=phiX4LY;

D:=15;
LinYang:=true;


height_init:=1;
size:=100;
torsion_jsQ:=[];
igusa_clebsch_list:=[];
size:=size;
height:=height_init;
while #torsion_jsQ lt size do
  height:=height+1;
  extra_a:=[ height/b : b in [-height..height] | b ne 0 and GCD(height,b) eq 1 ];
  extra_b:=[ a/height : a in [-height..height] | a ne 0 and GCD(height,a) eq 1 ];
  extra := extra_a cat extra_b;
  for q in extra do
  	try
	    j:=Evaluate(BelyiMap,q);
	    IgusaClebsch:=PQMIgusaClebsch(D,j : LinYang:=LinYang);	 
      //C:=HyperellipticCurveFromIgusaClebsch(IgusaClebsch);
      //[BaseRing(C) eq Rationals(), MestreObstructionIsSplit(D,j)];
	    Append(~torsion_jsQ,j);
	    //if MestreObstructionIsSplit(D,j) then 
        j;   Append(~igusa_clebsch_list,IgusaClebsch);
	    //end if;
	  catch e 
	    ;
	  end try;
  end for;
end while;


igusa_clebsch_list:=Setseq(Set(igusa_clebsch_list));
sprint:=[ #Sprint(I) : I in igusa_clebsch_list ];
ParallelSort(~sprint,~igusa_clebsch_list);

for i in [1..#igusa_clebsch_list] do 
  igusa_clebsch_list[i];
  TorsionGroupHeuristicUpToTwist(igusa_clebsch_list[i]: group:=AbelianGroup([4,4]),bound:=200, exponent:=2);
end for;




for IgusaClebsch in igusa_clebsch_list do 

  C:=HyperellipticCurveFromIgusaClebsch(IgusaClebsch);
#Sprint(C);
end for;
  //if BaseRing(C) eq Rationals() then 
    if BaseRing(C) eq Rationals() then 
      X:=ReducedWamelenModel(C);
    else 
      X:=C;
    end if;
    //X;

    prec := 5000;
    if BaseRing(X) eq Rationals() then 
    	F:=RationalsExtra(prec);
      XF:=ChangeRing(X,F);
    else 
      F := BaseNumberFieldExtra(DefiningPolynomial(BaseRing(X)),prec);
      tr,map:=IsIsomorphic(BaseRing(C),F);

      f:=HyperellipticPolynomials(X);
      coefs:= [map(a) : a in Coefficients(f)];
      XF:=HyperellipticCurve(coefs);
    end if;

    K:=HeuristicEndomorphismFieldOfDefinition(XF); 
    //K;
    XK:=ChangeRing(X,K);
    TorsionGroupHeuristicUpToTwist(XK : group:=AbelianGroup([4]),bound:=1000);

    _,B:=HeuristicEndomorphismAlgebra(XF : CC:=true);
    tr,A:=IsQuaternionAlgebra(B);
    tr;
    if tr then Discriminant(A); end if;
  //end if;
  print "========================";
end for;


for IgusaClebsch in igusa_clebsch_list do 
  TorsionGroupHeuristicUpToTwist(IgusaClebsch : group:=AbelianGroup([4]), bound:=500, exponent:=2);
  //C:=HyperellipticCurveFromIgusaClebsch(IgusaClebsch);
  //X:=ReducedWamelenModel(C);
  //PrimaryAbelianInvariants(TorsionSubgroup(Jacobian(X)));
end for;



X:=HyperellipticCurve([Polynomial([QuadraticField(-812013724793) | [ RationalField() | 414956051360639198491972304571334157358827945722204301972835703340495746847929518144372581300391523449121218299332659743484994270415830078125000000000000000000/33312207510932318906820137727226972475673915827998631118927684809639422030044009322653836243761194824141203846329577342621470743048581048876107038474243161186623429801888591835217678935932408270626460516469479353, 531678649241572323902692220720714344505071552606601756930617926903779411510249421279384270285217878624648893548702835554154607263550504737109375000000000000000000000/27049969702029503543651957927186839330908464974365127173385670706283192233867737563803758524047191717143051532645178479467439213118751709651238462692834348906757177040076517522128755148730451648314191775524128451330937698929 ], [ RationalField() | -45639659026359837218918597484279803892743245845781999365300570039115371819639934869892571161689025190628399268844708733212599829472656250000000000000000000/33184670193252343020169261192136364875402309751035649472573180775073429370706327295650852556960558368659631097780578844902390668930870044442735475100242646812152194139112860849771738097, -97451956123342981221106755280655946854729957126215825325790143983635515484850583612850704327277015173471407391433610913055468750000000000000000000000/33184670193252343020169261192136364875402309751035649472573180775073429370706327295650852556960558368659631097780578844902390668930870044442735475100242646812152194139112860849771738097 ], [ RationalField() | 1980721551645147079497587198093390336474520075884723021338192241607320005311069706588079444010013980910633165695263671875000000000000000000/40710667995768884431942906527919990213461657570614542076202158969539473434922541191997930417521261151708308723253311359575785708924143273213259121, 4421983924143698809273178196489786521090961145586438524918985956024724247527993168209932457856065468551789474106564869140625000000000000000000000/33057621158055467811552309439650946103917107734402601733348938748124062451735326758751213643878672938069552821415295569960512721873071679968293600678291086953 ], [ RationalField() | -33302988041780557655306265139077538885882609570700045260385205170293112712423534425352707648025978537568179492187500000000000000000000/40554805332046089624855402089751540241748207619805050650444354071675237541235119767485585560746211047415902044800535529, -108831713305093060289775557553300005779497067442300756695637284935897263634387043539401617632911258601562500000000000000000000000/40554805332046089624855402089751540241748207619805050650444354071675237541235119767485585560746211047415902044800535529 ], [ RationalField() | 296092136531054220019387679034566021608192500997879149710748713494989443946785797105240137825015324222216796875000000000000000000/40399539395695719407776301425517610848916088912313688155986626523932411316473726366776092321, 1079275481660042368548762739096233153472188834178180369073698413961223061652716562926942220825681640625000000000000000000000/40399539395695719407776301425517610848916088912313688155986626523932411316473726366776092321 ], [ RationalField() | -1349303254841152248042323127837880300094247497520194970976847214049836216846790232022704990025704941406250000000000000000000/40244867902119599364427042586859444949038900818478453050766482329, -5205608140834176356222726511230506503797121034880625105614558210489306235552928187207892161718750000000000000000000000/40244867902119599364427042586859444949038900818478453050766482329 ], [ RationalField() | 2489674238500558122554532296730293791789289661531974916047997837578817331084250809093982624736328125000000000000000000/40090788575466244202808812522868365521, 9696015370440776807521093114014058306411540730031832295654531089819236604211754454252734375000000000000000000000/40090788575466244202808812522868365521 ]]), Polynomial([QuadraticField(-812013724793) |])]);


